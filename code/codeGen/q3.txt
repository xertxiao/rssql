CREATE STREAM ride (Ts: timestamp, PickUp: str, DropTo: str, Fare: double) WITH recursive bestPrice (Ts, PickUp, DropTo, min() AS BestFare) AS (SELECT Ts, PickUp, DropTo, Fare FROM ride) UNION (SELECT greatest(ride.Ts, bestPrice.Ts), bestPrice.PickUp, ride.DropTo, bestPrice.BestFare + ride.Fare FROM ride, bestPrice WHERE ride.PickUp = bestPrice.DropTo) SELECT PickUp, DropTo, BestFare FROM bestPrice WINDOW[60]